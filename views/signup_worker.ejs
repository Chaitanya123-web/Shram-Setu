<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up</title>
  <link rel="stylesheet" href="style/style.css" />
</head>
<body>
  <div class="container">
    <!-- Left Panel -->
    <div class="left-panel">
      <img src="images/logo.png" alt="Shram Setu Logo" class="logo"/>
      <p class="p">Connecting Labor with Dignity</p>
    </div>

    <!-- Right Panel - Sign Up -->
    <div class="right-panel">
      <div class="form-box">
        <h1>Sign Up As Worker</h1>
        <form action="/signup_worker" method="post">
          <label for="name">Name</label>
          <input type="text" id="name" placeholder="Enter your Name" name="name" required />

          <label for="signup-id">Mobile Number</label>
          <input type="number" id="signup-id" placeholder="Enter your Mobile Number" name="mobile" required />

          <label for="job">Job</label>
          <input type="text" id="job" placeholder="Enter your Job" name="job" required />

          <label for="location_display">Location</label>
          <input type="text" id="location_display" placeholder="Fetching your location..." readonly required />

          <!-- âœ… Hidden inputs inside form -->
          <input type="hidden" name="latitude" id="latitude" />
          <input type="hidden" name="longitude" id="longitude" />
          <input type="hidden" name="location" id="location" />

          <label for="signup-password">Password</label>
          <div class="input-wrapper">
            <input type="password" id="signup-password" placeholder="Create password" name="password" required />
            <span class="toggle-password" onclick="togglePassword('signup-password', this)">ðŸ‘€</span>
          </div>

          <label for="confirm-password">Confirm Password</label>
          <div class="input-wrapper">
            <input type="password" id="confirm-password" placeholder="Re-enter password" name="confirm_password" required />
            <span class="toggle-password" onclick="togglePassword('confirm-password', this)">ðŸ‘€</span>
          </div>

          <button type="submit">Sign Up</button>
          <p>Already have an account? <a href="/login_worker">Login</a></p>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Auto fetch location on load
    window.onload = async function() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;

          try {
            const response = await fetch('/mylocation', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ latitude, longitude })
            });

            const formatted = await response.text();

            document.getElementById('latitude').value = latitude;
            document.getElementById('longitude').value = longitude;
            document.getElementById('location').value = formatted;
            document.getElementById('location_display').value = formatted;
          } catch (err) {
            document.getElementById('location_display').value = 'Location fetch error';
            console.error('Error:', err);
          }
        }, () => {
          document.getElementById('location_display').value = 'Permission denied';
        });
      } else {
        document.getElementById('location_display').value = 'Geolocation not supported';
      }
    };
  </script>

  <script src="script/script.js"></script>
</body>
</html>
